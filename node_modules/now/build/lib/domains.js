"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_lib=require("../lib"),_lib2=_interopRequireDefault(_lib),_isZeitWorld=require("./is-zeit-world"),_isZeitWorld2=_interopRequireDefault(_isZeitWorld),_domainRegex2=require("domain-regex"),_domainRegex3=_interopRequireDefault(_domainRegex2),_chalk=require("chalk"),_chalk2=_interopRequireDefault(_chalk),_errors=require("./errors"),domainRegex=(0,_domainRegex3["default"])(),Domains=function(e){function r(){return(0,_classCallCheck3["default"])(this,r),(0,_possibleConstructorReturn3["default"])(this,(0,_getPrototypeOf2["default"])(r).apply(this,arguments))}return(0,_inherits3["default"])(r,e),(0,_createClass3["default"])(r,[{key:"ls",value:function(){function e(){return r.apply(this,arguments)}var r=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function t(){var e=this;return _regenerator2["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.retry(function(){var r=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function t(r,n){var a,o;return _regenerator2["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e._debug&&console.time("> [debug] #"+n+" GET /domains"),r.next=3,e._fetch("/domains");case 3:return a=r.sent,e._debug&&console.timeEnd("> [debug] #"+n+" GET /domains"),r.next=7,a.json();case 7:return o=r.sent,r.abrupt("return",o.domains);case 9:case"end":return r.stop()}},t,e)}));return function(e,t){return r.apply(this,arguments)}}()));case 1:case"end":return r.stop()}},t,this)}));return e}()},{key:"rm",value:function(){function e(e){return r.apply(this,arguments)}var r=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function t(e){var r=this;return _regenerator2["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.retry(function(){var t=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function n(t,a){var o,u;return _regenerator2["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r._debug&&console.time("> [debug] #"+a+" DELETE /domains/"+e),n.next=3,r._fetch("/domains/"+e,{method:"DELETE"});case 3:if(o=n.sent,r._debug&&console.timeEnd("> [debug] #"+a+" DELETE /domains/"+e),403!==o.status){n.next=7;break}return n.abrupt("return",t(new Error("Unauthorized")));case 7:if(200===o.status){n.next=12;break}return n.next=10,o.json();case 10:throw u=n.sent,new Error(u.error.message);case 12:case"end":return n.stop()}},n,r)}));return function(e,r){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}},t,this)}));return e}()},{key:"add",value:function(){function e(e){return r.apply(this,arguments)}var r=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function t(e){var r,n,a,o,u;return _regenerator2["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(domainRegex.test(e)){t.next=4;break}throw r=new Error("The supplied value "+_chalk2["default"].bold('"'+e+'"')+" is not a valid domain."),r.userError=!0,r;case 4:return n=void 0,t.prev=5,console.log("> Verifying nameserversâ€¦"),t.next=9,this.getNameservers(e);case 9:a=t.sent,n=a.nameservers,t.next=18;break;case 13:throw t.prev=13,t.t0=t["catch"](5),o=new Error("Unable to fetch nameservers for "+_chalk2["default"].underline(_chalk2["default"].bold(e))+"."),o.userError=!0,o;case 18:if(!(0,_isZeitWorld2["default"])(n)){t.next=23;break}return console.log("> Verification "+_chalk2["default"].bold("OK")+"!"),t.abrupt("return",this.setupDomain(e));case 23:throw this._debug&&console.log('> [debug] Supplied domain "'+e+'" has non-zeit nameservers'),u=new Error(_errors.DNS_VERIFICATION_ERROR),u.userError=!0,u;case 27:case"end":return t.stop()}},t,this,[[5,13]])}));return e}()}]),r}(_lib2["default"]);exports["default"]=Domains;